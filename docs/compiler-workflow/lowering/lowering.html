<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/dev-book/blog/rss.xml" title="Jacy DevBook RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/dev-book/blog/atom.xml" title="Jacy DevBook Atom Feed"><title data-react-helmet="true">Lowering | Jacy DevBook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jacylang.github.io/dev-book/dev-book/docs/compiler-workflow/lowering/lowering"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Lowering | Jacy DevBook"><meta data-react-helmet="true" name="description" content="Lowering, i.e. IR simplifying is the process when we take one IR, remove useless information, and generalize similar units to common structures, producing the second, lowered IR."><meta data-react-helmet="true" property="og:description" content="Lowering, i.e. IR simplifying is the process when we take one IR, remove useless information, and generalize similar units to common structures, producing the second, lowered IR."><link data-react-helmet="true" rel="shortcut icon" href="/dev-book/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jacylang.github.io/dev-book/dev-book/docs/compiler-workflow/lowering/lowering"><link data-react-helmet="true" rel="alternate" href="https://jacylang.github.io/dev-book/dev-book/docs/compiler-workflow/lowering/lowering" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jacylang.github.io/dev-book/dev-book/docs/compiler-workflow/lowering/lowering" hreflang="x-default"><link rel="stylesheet" href="/dev-book/assets/css/styles.45508a18.css">
<link rel="preload" href="/dev-book/assets/js/runtime~main.58d12d78.js" as="script">
<link rel="preload" href="/dev-book/assets/js/main.c2ebe015.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dev-book/"><div class="navbar__logo"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">My Site</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dev-book/docs/index">Tutorial</a><a class="navbar__item navbar__link" href="/dev-book/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jacylang/jacy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Jacy on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/jacylang/dev-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>DevBook GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-book/docs/index">Jacy DevBook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-book/docs/how-to-run">How to run</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Lincy</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">appendices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">cli</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">code-docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">compile-time-evaluation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">compiler-workflow</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/compiler-workflow/index">Compilation Workflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">lowering</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/compiler-workflow/lowering/hir">HIR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/compiler-workflow/lowering/index">Lowering &amp; HIR</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev-book/docs/compiler-workflow/lowering/lowering">Lowering</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">name-res-stage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">parsing-stage</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">type-system</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">concept</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">ideas</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">particles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">roadmaps</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">suggestions</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">user-guide</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Lowering</h1></header><p>Lowering, i.e. IR simplifying is the process when we take one IR, remove useless information, and generalize similar units to common structures, producing the second, lowered IR.
A common example of lowering is AST to HIR lowering, which is done right after parsing and name resolution stages are complete. There are also other lowering modifications but they are atomic and done during more complex stages, whereas AST lowering is a separate stage.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="transformations">Transformations<a aria-hidden="true" class="hash-link" href="#transformations" title="Direct link to heading">â€‹</a></h2><p>During AST lowering bunch of AST nodes are removed completely and replaced with more common ones.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="nodes-lowered-to-loop">Nodes lowered to <code>loop</code><a aria-hidden="true" class="hash-link" href="#nodes-lowered-to-loop" title="Direct link to heading">â€‹</a></h3><p>In the HIR there is nothing like <code>for</code> or <code>while</code> loops -- they are replaced with <code>loop</code> expression.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="for-loop-lowering"><code>for</code> loop lowering<a aria-hidden="true" class="hash-link" href="#for-loop-lowering" title="Direct link to heading">â€‹</a></h4><p>At first, we need to establish what the <code>for</code> loop can do in <em>Jacy</em>. No C-like <code>for</code> loop exists and the only one construction is using iterator. C-like loops iterating over integer values are covered with iteration over ranges.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">for i in 0..100 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let&#x27;s disassemble this loop into instructions that are done implicitly.
<code>for</code> loop accepts the expression of a type that implements the <code>Iterator</code> trait. In this case, it is an integer range from <code>0</code> to <code>100</code> exclusively. So, at first, we need to get an iterator of <code>0..100</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let mut iter = (0..100).intoIter();</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here, the compiler uses <code>intoIter</code> because <code>0..100</code> is moved into the <code>for</code> loop, not borrowed.</p><p>Then we need to go through all values:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">let mut iter = (0..100).intoIter();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Added</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while let Some(i) = iter.next() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here we use <code>while let</code> which is a high-level syntactic sugar that is in fact &quot;while the pattern on the left side matches the value on the right side do ...&quot;. <code>while let</code> loop is also lowered, read further for more information.
<code>iter.next</code> (<code>Iterator::next</code>) method returns <code>T?</code> (in this particular case <code>T</code> is <code>int</code>), that is an optional next value if some exists.</p><p>The body of the <code>while let</code> is the same as for the initial <code>for</code> loop.</p><p>In the next chapters, we will discuss <code>while let</code> lowering where this example will be lowered completely.</p><h4 class="anchor anchorWithStickyNavbar_31ik" id="while-loop-lowering"><code>while</code> loop lowering<a aria-hidden="true" class="hash-link" href="#while-loop-lowering" title="Direct link to heading">â€‹</a></h4></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/compiler-workflow/lowering/lowering.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dev-book/docs/compiler-workflow/lowering/index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Lowering &amp; HIR</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dev-book/docs/compiler-workflow/name-res-stage/importation-&amp;-module-system"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Importation and the Module system<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#transformations" class="table-of-contents__link toc-highlight">Transformations</a><ul><li><a href="#nodes-lowered-to-loop" class="table-of-contents__link toc-highlight">Nodes lowered to <code>loop</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dev-book/docs/index">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/jacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dev-book/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Jacy DevBook, JacyLang team.</div></div></div></footer></div>
<script src="/dev-book/assets/js/runtime~main.58d12d78.js"></script>
<script src="/dev-book/assets/js/main.c2ebe015.js"></script>
</body>
</html>