<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<title data-react-helmet="true">Invert Rust for usability | Jacy</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://jacylang.github.io/dev-book/docs/appendices/backlog/invert-rust"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Invert Rust for usability | Jacy"><meta data-react-helmet="true" name="description" content="This article is deprecated as far as the key concept was invalidly described, there&#x27;re replacement in ideas/invert-rust which is right"><meta data-react-helmet="true" property="og:description" content="This article is deprecated as far as the key concept was invalidly described, there&#x27;re replacement in ideas/invert-rust which is right"><link data-react-helmet="true" rel="shortcut icon" href="/dev-book/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://jacylang.github.io/dev-book/docs/appendices/backlog/invert-rust"><link data-react-helmet="true" rel="alternate" href="https://jacylang.github.io/dev-book/docs/appendices/backlog/invert-rust" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://jacylang.github.io/dev-book/docs/appendices/backlog/invert-rust" hreflang="x-default"><link rel="stylesheet" href="/dev-book/assets/css/styles.a61cb2a9.css">
<link rel="preload" href="/dev-book/assets/js/runtime~main.e1fe2616.js" as="script">
<link rel="preload" href="/dev-book/assets/js/main.0e903e24.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/dev-book/"><div class="navbar__logo"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Jacy DevBook</b></a><a class="navbar__item navbar__link navbar__link--active" href="/dev-book/docs/index">Docs</a><a class="navbar__item navbar__link" href="/dev-book/user-guide">User Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/jacylang/jacy" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Jacy on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/jacylang/dev-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>DevBook GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">üåô</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">‚òÄÔ∏è</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/dev-book/"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/dev-book/img/logo.svg" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Jacy DevBook</b></a><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-book/docs/index">Jacy DevBook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-book/docs/how-to-run">How To Run</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">The Concept</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CLI</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Compiler Workflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Code Docs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Particles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Ideas</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Appendices</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/index">Appendices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/why">Why?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/ops-and-puncts">Operators and punctuations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/taxonomy-&amp;-glossary">Taxonomy and glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/checklist">Programming Language Checklist üòÖ</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Roadmaps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/antlr4-syntax">ANTLR4 Syntax for _Jacy_</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">backlog</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/backlog/index">Backlog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/dev-book/docs/appendices/backlog/invert-rust-v2">Invert Rust</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/dev-book/docs/appendices/backlog/invert-rust">Invert Rust for usability</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">cheatsheets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">spec</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JON (Jacy Object Notation)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/dev-book/docs/compiler-faq">Compiler FAQ</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Invert Rust for usability</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="this-article-is-deprecated-as-far-as-the-key-concept-was-invalidly-described-therere-replacement-in-ideasinvert-rust-which-is-right">This article is deprecated as far as the key concept was invalidly described, there&#x27;re replacement in ideas/invert-rust which is right<a aria-hidden="true" class="hash-link" href="#this-article-is-deprecated-as-far-as-the-key-concept-was-invalidly-described-therere-replacement-in-ideasinvert-rust-which-is-right" title="Direct link to heading">‚Äã</a></h2><blockquote><p><strong>Please read this</strong>
When reading my ideas keep in mind that it is a mind flow but not a RFC. While you read you can how my opinion is
jumping back and forth, so statements described earlier can conflict with some later.</p></blockquote><p>This idea is really complex and it is hard to predict if it would work.</p><p>As far as I want <em>Jacy</em> to be aimed at more high-level than Rust do, I appreciate usability in the way when we save the
most important aspects of Rustish safety and power with a lack of some low-level features.</p><h2 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="why-not-rust-like">Why not Rust-like<a aria-hidden="true" class="hash-link" href="#why-not-rust-like" title="Direct link to heading">‚Äã</a></h2><p>What is problematic for me in Rust design (this is not a list of Rust cons, no, these are things I find too
explicit/low-level, etc.).</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="move-by-default">Move by default<a aria-hidden="true" class="hash-link" href="#move-by-default" title="Direct link to heading">‚Äã</a></h3><p>Rust is &quot;always move&quot; PL, which means that even primitives are moved but copied before. This is a good solution and I
like it more than C++ where we need to write <code>const &amp;</code> or <code>std::move</code> always everywhere.</p><p>Anyway, most of the time we pass non-Copy types as immutable references, that is, we rarely need to get a reference to
modify its underlying value. Moves, as I think, used more often than <code>&amp;mut</code> but not as often as immutable references.</p><p>The solution is to have immutable references by default, that is, we replace &quot;Move or Copy&quot; with &quot;Borrow or Copy&quot;. I&#x27;ll
call this PIR (Pass by Immutable Reference) further.</p><p>I want to note that I don&#x27;t really like the idea of dividing all programming languages to groups like &quot;pass-by-value&quot; or
&quot;pass-by-reference&quot;, etc. Because most of the languages mix it, or &quot;pass-by-reference&quot; in case means &quot;make a reference
and pass-by-value&quot;, anyway I&#x27;ll use PIR as it is simple to describe common cases. Just keep in mind that it mostly about
assignment and passing to functions.</p><p>Doing so requires &quot;move&quot; to be a first-class operation, it can be a specific operator, e.g. prefix <code>^</code> to move or just
the <code>move</code> keyword.</p><p>Example.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">struct Struct {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    field: i32,</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func printByRef(instance: A) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(instance.field);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func printMove(move instance: A) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(instance.field);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func printNum(num: i32) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(num);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func changeNum(ref num: i32) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    num = 0;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let instance = Struct {field: 666};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    printByRef(instance); // `instance` is not moved here like in Rust</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    printByRef(instance); // `instance` here and before is passed by reference</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    printMove(move instance); // `move` is explicit</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    // printMove(move instance); // Error: `instance` is moved</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    // printByRef(instance); // Same error: `instance` is moved</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let num = 1000;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    printNum(num);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    printNum(num); // Everything is find -- `i32` is a Copy-type</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let mut var = 0xB16B00B5;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(var); // Prints 2976579765</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    changeNum(var);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(var); // Prints 0</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    </span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let mut a = Struct {field: 100};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    </span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let mut r0 = a;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let mut r1 = a; // Error: Cannot borrow `a` as mutable more than once</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Rust revolves around an idea of owning, as <em>Jacy</em> does, thus being hardly inspired by Rust we can consider &quot;making a
reference&quot; not being a &quot;usage&quot;. What this means is just all about how we see the language to take a place in world of
type theory, saying that we&#x27;ve got affine type, that is, value must be used one or no times, we can say that some cases
are not under these rules. That&#x27;s what Rust does -- making reference to some value, we do not use the value just
immutably borrowing it. Considering this, our hands are clean üòÉ. Anyway, affine types in Rust give us some cleaner code
than PIR, as we make references implicitly, thus it opens a vista to do break linearity of program.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="the-problems-i-see">The problems I see<a aria-hidden="true" class="hash-link" href="#the-problems-i-see" title="Direct link to heading">‚Äã</a></h3><p>I think it is actually impossible to replace Rustish &quot;move by default&quot; with &quot;ref by default&quot; and break everything. The
only problems that come up from this solution appear from the view of semantics.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="copy-types-borrowing">Copy-Types borrowing<a aria-hidden="true" class="hash-link" href="#copy-types-borrowing" title="Direct link to heading">‚Äã</a></h4><p>Having PIR we cannot get rid of references in semantics, as far as we don&#x27;t borrow Copy-types and so need a way to pass
them by reference. E.g. we have a variable storing <code>i32</code>, that is, it won&#x27;t be passed as PIR, and if we need to have a
function modifying <code>i32</code> we need to explicitly pass it by reference.</p><p>Thus let&#x27;s imagine we have <code>ref</code> keyword which is used in both function signature and passing to function.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="lack-of-explicitness">Lack of explicitness<a aria-hidden="true" class="hash-link" href="#lack-of-explicitness" title="Direct link to heading">‚Äã</a></h4><p>E.g. in Rust when we want to slice an array, we write <code>let slice = &amp;array[from..to]</code>, &#x27;cause the size of the slice is
not known at compile-time, so we cannot allocate it on the stack. In PIR it would be <code>let slice = array[from..to]</code>, as
far as the slice is not a Copy-Type (same in Rust). That&#x27;s just an example of what we hide with PIR but not a problem.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="actual-types">Actual types<a aria-hidden="true" class="hash-link" href="#actual-types" title="Direct link to heading">‚Äã</a></h4><p>If we consider that a type which is not a Copy-Type and passed without any qualifiers -- it is a reference to type, then
this is a reference type. So, let&#x27;s assume we have some intrinsic method to get type of an expression as string, what
will it print for function that accepts <code>Struct {field: 1234}</code>? -- <code>Struct</code> or <code>&amp;Struct</code>.</p><p>As far as we don&#x27;t remove references at all (they are still required to be in the language) -- the type is... ü•Åü•Åü•Å
<code>&amp;Struct</code>. Yeah, user have written <code>Struct</code> but that&#x27;s not the truth as all non-copy-types are passed by reference. And
as far as we anyway separate concepts of references and values, we need it to be a reference.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="generics-important">Generics (!important)<a aria-hidden="true" class="hash-link" href="#generics-important" title="Direct link to heading">‚Äã</a></h4><p>This is really interesting problem to solve. As we do not have GC we cannot rely on the fact that everything will be
cleared as we put <code>free</code> at CT. The problem is not that <code>Vec&lt;Struct&gt;</code> is <code>&amp;Vec&lt;Struct&gt;</code>... No, the problem is that is it
<code>&amp;Vec&lt;Struct&gt;</code> or <code>&amp;Vec&lt;&amp;Struct&gt;</code>?! Rapidly answering this question I would say, it is a <code>&amp;Vec&lt;Struct&gt;</code>, because having
<code>&amp;Vec&lt;&amp;Struct&gt;</code> we will require user to always have all <code>Struct</code>s alive as long as <code>Vec</code> is used, as far as it contains
references.</p><p>From the problem of generics I deduce maybe the most important rule about PIR:</p><blockquote><p><strong>PIR means prepending passed non-copy type with reference, but not that all types are reference-types by default</strong></p></blockquote><p>Considering this, everything becomes more clear and I hope that I don&#x27;t miss anything. üòê</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="how-do-i-actually-pass-by-value-important">How do I actually pass-by-value? (!important)<a aria-hidden="true" class="hash-link" href="#how-do-i-actually-pass-by-value-important" title="Direct link to heading">‚Äã</a></h4><p>Same as generics this one is really complex question too. Keep in mind that we aren&#x27;t talking about &quot;How to
pass-by-value could be implemented&quot; from view of code generation -- this is an answered question. The problem is in the
semantics and syntax. What am I talking about is that removing explicit reference types mostly everywhere we get lack of
opportunity to qualify value type. Further I&#x27;m gonna describe a list of all rules about PIR, so here won&#x27;t be
comprehensive solution as it would be more understandable as if we just look at specific rules. Anyway, here it is.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">// `Kitty` is a structure declared somewhere</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(kitty: Kitty) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(kitty.msg);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let kitty = Kitty {msg: &quot;Meow, bitch&quot;};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    foo(kitty);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here I meant to copy <code>kitty</code>, but because of PIR <code>kitty</code> is passed by reference. STOP, it is C++ and not Rust, we don&#x27;t
copy by default, and we don&#x27;t move by default. So... How do I make it creating a copy of <code>kitty</code>?</p><ul><li>Overload <code>Copy</code> trait?</li><li>Overload <code>Clone</code> trait? Both.</li><li><code>Copy</code> - When type overloads <code>Copy</code> trait, it is always (forget about optimizations) copied, thus no reference
created.</li><li><code>Clone</code> - When type overloads <code>Clone</code> trait, it is passed by reference!</li></ul><p>The rule about <code>Clone</code> sounds right as we don&#x27;t actually modify the source and we just make a copy explicitly. There&#x27;s
still a problem -- why do we need a reference as we cloned source, we&#x27;ll just add additional work for run-time which is
not actually required?</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="clone-trait-important"><code>Clone</code> trait (!important)<a aria-hidden="true" class="hash-link" href="#clone-trait-important" title="Direct link to heading">‚Äã</a></h4><p><code>Clone</code> trait in <em>Jacy</em> as in Rust is used to provide explicit way to copy source object.</p><p>Let&#x27;s look at an example similar to one above.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">// Assume somewhere exists the `Kitty` type and it implements the `Clone` trait</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(kitty: Kitty) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(kitty.msg);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let kitty = Kitty {msg: &quot;Meow, bitch&quot;};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    foo(kitty.clone());</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">} </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>We made a clone, but is there any reason to pass it by reference? It is a rhetorical question, and the answer is NO, and
it forces me to describe implicit-move rules. In C++, it is common to optimize some copy cases to move, e.g., when we
return a local variable, it is moved -- it is called copy/move elision. In <em>Jacy</em> these cases are wider as we need not
only to handle copies but also references.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="patterns">Patterns<a aria-hidden="true" class="hash-link" href="#patterns" title="Direct link to heading">‚Äã</a></h4><p><code>let</code> bindings and <code>func</code> parameters are patterns, also there&#x27;re <code>if let</code> and <code>match</code>. Do patterns need to be PIR or
not? -- Actually, they MUST.</p><p>Let&#x27;s assume we&#x27;ve got.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">struct StructType {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    field: Vec&lt;i32&gt;,</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that <code>StructType.field</code> is not of type <code>&amp;Vec&lt;i32&gt;</code>, it is non-reference, because PIR is only about passing values.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">let a: StructType = structInstance; // `structInstance` is non-copy type</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">// Desugared to</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">let a: &amp;StructType = &amp;structInstance;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">// or</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">let ref a: &amp;StructType = structInstance;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(param: StructType);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">foo(structInstance);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">// Desugared to</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(param: &amp;StructType);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">foo(&amp;structInstance);</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">match a {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    StructType {field} =&gt; // ...</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">// Desugared to</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">match &amp;a {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    StructType {ref field} =&gt; // ...</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="examples">Examples<a aria-hidden="true" class="hash-link" href="#examples" title="Direct link to heading">‚Äã</a></h3><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="passes">&quot;Passes&quot;<a aria-hidden="true" class="hash-link" href="#passes" title="Direct link to heading">‚Äã</a></h4><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="assignment">Assignment<a aria-hidden="true" class="hash-link" href="#assignment" title="Direct link to heading">‚Äã</a></h5><p><code>a = b</code> in Rust is <code>a = move b</code> but with PIR it will become <code>a = &amp;b</code>, if <code>b</code> is another variable of non-copy type.</p><p>Let&#x27;s look at examples to grasp when variable is automatically becomes a reference and where not.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">let a = StructType {field: Vec::new()};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">let b = a;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Here, <code>a</code> is of type <code>StructType</code> because of move elision, but <code>b</code> would be <code>&amp;StructType</code> as it is automatically
borrowed.</p><h5 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="functions">Functions<a aria-hidden="true" class="hash-link" href="#functions" title="Direct link to heading">‚Äã</a></h5><p>When we create a function like <code>func foo(param: String)</code>, <code>param</code> is of type <code>&amp;String</code>. To make it mutable type must be
prepended with <code>mut</code>, so it gonna look like <code>mut String</code> which is actually a <code>&amp;mut String</code>.</p><p>Copy-types (e.g. <code>i32</code>) passed by copy, that is, they are passed by value and copied. So, if we want to change the value
of some variable containing copy type we would write <code>func foo(param: ref mut i32)</code> and must be explicitly passed with
<code>ref mut</code> prefix.</p><h3 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="rules">Rules<a aria-hidden="true" class="hash-link" href="#rules" title="Direct link to heading">‚Äã</a></h3><p>Finally, after reviewing some cases, I&#x27;d like to reduce them to the list of rules.</p><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="1-if-non-copy-type-passed-to-function-or-assigned-it-is-borrowed">1. If non-copy type passed to function or assigned, it is borrowed<a aria-hidden="true" class="hash-link" href="#1-if-non-copy-type-passed-to-function-or-assigned-it-is-borrowed" title="Direct link to heading">‚Äã</a></h4><p>Examples.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(name: String) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(&quot;My name is $name&quot;);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let savedName = String::from(&quot;Mr. Doctor&quot;);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let name = savedName; // `savedName` is not either copied or moved -- `name` is an immutable reference to `savedName`</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    foo(name); // `name` is not moved -- it is passed by immutable reference</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="2-moves-are-explicit-in-signatures-and-in-calls">2. Moves are explicit in signatures and in calls<a aria-hidden="true" class="hash-link" href="#2-moves-are-explicit-in-signatures-and-in-calls" title="Direct link to heading">‚Äã</a></h4><p>Example.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">func foo(move name: String) {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    print(&quot;My name is $name&quot;);</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let name = &quot;Brendan Eich&quot;;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    foo(move name); // `name` must be moved explicitly</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4 class="anchor anchorWithHideOnScrollNavbar_3R7-" id="3-data-stored-in-structures-must-be-explicitly-qualified-as-reference">3. Data, stored in structures must be explicitly qualified as reference<a aria-hidden="true" class="hash-link" href="#3-data-stored-in-structures-must-be-explicitly-qualified-as-reference" title="Direct link to heading">‚Äã</a></h4><p>Example.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jc"><pre tabindex="0" class="prism-code language-jc codeBlock_23N8 thin-scrollbar" style="color:#5C6166;background-color:#FCFCFC"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#5C6166"><span class="token plain">struct Data {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    inner: Vec&lt;i32&gt;</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">struct Struct {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    data: &amp;Data,</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">func main {</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let data = Data {inner: Vec::from([1, 2, 3])};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    let s = Struct {data: &amp;data};</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">    // let s2 = Struct {data: data} // Error: expected `&amp;Data` type for `data`</span><br></span><span class="token-line" style="color:#5C6166"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Actually, this is just an example where we omit usage of lifetimes. No-lifetimes solutions gonna be researched in
further ideas.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/jacylang/dev-book/edit/master/docs/appendices/backlog/invert-rust.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/dev-book/docs/appendices/backlog/invert-rust-v2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ <!-- -->Invert Rust</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/dev-book/docs/appendices/cheatsheets/index"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cheatsheets<!-- --> ¬ª</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#this-article-is-deprecated-as-far-as-the-key-concept-was-invalidly-described-therere-replacement-in-ideasinvert-rust-which-is-right" class="table-of-contents__link toc-highlight">This article is deprecated as far as the key concept was invalidly described, there&#39;re replacement in ideas/invert-rust which is right</a></li><li><a href="#why-not-rust-like" class="table-of-contents__link toc-highlight">Why not Rust-like</a><ul><li><a href="#move-by-default" class="table-of-contents__link toc-highlight">Move by default</a></li><li><a href="#the-problems-i-see" class="table-of-contents__link toc-highlight">The problems I see</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li><li><a href="#rules" class="table-of-contents__link toc-highlight">Rules</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/dev-book/docs/index">Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/jacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Jacy DevBook, JacyLang team.</div></div></div></footer></div>
<script src="/dev-book/assets/js/runtime~main.e1fe2616.js"></script>
<script src="/dev-book/assets/js/main.0e903e24.js"></script>
</body>
</html>